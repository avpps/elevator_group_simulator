<!DOCTYPE html>
<html>

<head>
  <title>Simulator_stat</title>
</head>

{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'simulator/style.css' %}" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<body>

	<ul>
		<li><a href="{% url 'simulator:index' %}">Home</a></li>
		<li><a href="{% url 'simulator:newBuilding' %}">Create building</a></li>
		<li><a href="{% url 'simulator:newBuildingDetails' %}">Building details</a></li>
		<li><a href="{% url 'simulator:newSimulation' %}">Run simulation</a></li>
		<li><a class="active" href="{% url 'simulator:simulationStat' %}">Statistics</a></li>
		<li><a href="{% url 'simulator:signIn' %}">SignIn</a></li>
	</ul>
	
	<div class='flex-container'>
	
		<div class="flex-item1">
		<nav class="vertical-menu">
			{% for no in charts_number %}
				<select id="simulationsRequest{{ no }}">
						<option style='width:150px;' value=None>building {{ no }}</option>
					{% for building in buildings_list %}
						<option style='width:150px;' value={{ building.id }}>{{ building.id }} {{ building.name }}</option>
					{% endfor %}
				</select>

				<select id="chartRequest{{ forloop.counter }}">
				</select>

				<br>
				<br>
				<br>
			{% endfor %}
			
		</nav>
		</div>

		<div class="flex-item2">
			
			{% for no in charts_number %}
				<p id="p_chart{{no}}">
				<canvas id="myChart{{no}}" width=100% height=75%></canvas>
				</p>
			{% endfor %}
			
		</div>
		
	</div>
	
	
	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
	<script src="{% static 'js/app.js' %}"></script>
	
	{% for no in charts_number %}
		<script>
			
		$('#simulationsRequest'+{{no}}).change(function () {
			var building_id = $(this).val();

			$.ajax({
				url: 'ajax/simulationsRequest',
				data: {
				  'building_id': building_id
				},
				dataType: 'json',
				success: function (data) {
					content = "";
					temp = "<option style='width:150px;' value=val>val</option>"
					sim_dict = data.simulation_list;
					content += temp.replace(/val/g, 'simulation');
					for(var key in sim_dict) {
						content += temp.replace(/val/g, sim_dict[key]);
					}
					document.getElementById("chartRequest"+{{no}}).innerHTML = content
				}
			});
		});

		$('#chartRequest'+{{no}}).change(function () {
			
			var simulation_id = $(this).val();
			
			//reset canvas before draw new chart:
			$('#myChart'+{{no}}).remove();
			$('#p_chart'+{{no}}).append('<canvas id="myChart{{no}}" width=100% height=75%></canvas>');
			
			$.ajax({
				url: 'ajax/chartRequest',
				data: {
				  'simulation_id': simulation_id
				},
				dataType: 'json',
				
				success: function (data) {
				
					var myChart=null;
					
					if(myChart!=null){
						myChart.destroy();
						console.log('destr');
					}
					
					var ctx = document.getElementById("myChart"+{{no}}).getContext('2d');
					
					myChart = new Chart(ctx, {
						type: 'scatter',
						data: {
							datasets: [{
								label: 'AWT',
								data: data.AWT,
								fill: false,
								borderColor: 'rgb(255, 0, 0)',

							},
										{
								label: 'ATTD',
								data: data.ATTD,
								fill: false,
								borderColor: 'rgb(255, 191, 0)',


							},
										{
								label: 'AINT',
								data: data.AINT,
								fill: false,
								borderColor: 'rgb(0, 255, 0)',

							},
										{
								label: 'ACLF',
								data: data.ACLF,
								fill: false,
								borderColor: 'rgb(64, 0, 255)',

							}],							
						},
						options: {
							scales: {
								
								xAxes: [{
									ticks: {
										type: 'linear',
										position: 'bottom',
									},
								}],
								yAxes: [{
									ticks: {
										beginAtZero: true,
									},
								}]
							},
							animation: {
								duration: 10
							}
						},
					});	
				}
			});

		});
		

		</script>	
	{% endfor %}

	


</body>
</html>